extends ./layouts/main 

block content
  .container.mt-5
  
    if success_msg.length > 0
      .alert.alert-success#flash-msg= success_msg
            
    
    h1 Statistics
    .row.g-2
        
        .col-md-3
            .card
                .card-body 
                    h3.card-title Cashback received
                    h4.card-subtitle.mb-2.text-body-secondary EUR 0.99
                    p.card-text 2 offers completed 
        .col-md-3
            .card
                .card-body 
                    h3.card-title Cashback pending
                    h4.card-subtitle.mb-2.text-body-secondary EUR 14.99
                    p.card-text 4 offers pending 
        .col-md-3
            .card
                .card-body 
                    h3.card-title Available offers
                    h4.card-subtitle.mb-2.text-body-secondary EUR 13.35
                    p.card-text 5 offers available 
        .col-md-3
            .card
                .card-body 
                    h3.card-title Total % received
                    h4.card-subtitle.mb-2.text-body-secondary EUR 123.45 - 78%
                    p.card-text 12/15 offers completed 
    
    .row.mb-3.mt-3
        .col.d-flex.justify-content-between.align-items-center
            .btn-group(role="group" aria-label="Filtering buttons")
                button.btn.btn-secondary.m-1(type="button") Available 
                button.btn.btn-secondary.m-1(type="button") Uploaded
                button.btn.btn-secondary.m-1(type="button") Confirmed 
                button.btn.btn-secondary.m-1(type="button") Completed 
            
        .col-4
        .col
            button.btn.btn-secondary.m-2.text-right(type="button", data-bs-toggle="modal", data-bs-target="#cashbackFormModal") + Add new offer

    
    - const cashbackOffers = allCashbackOffers || []
    
    if cashbackOffers.length === 0
        .row.m-2 
            .col.text-center 
                p No cashback offers here yet.
    else
        each item in cashbackOffers
            .row.m-2 
            .card.mb-3.p-3
                h5= item.product_name
                p Status: #{item.status || 'N/A'}
                if item.photo_url
                    img(src=item.photo_url, width="200", style="max-height:150px; object-fit:cover;")
                p Cashback: #{item.cashback_amount} EUR
                p Store: #{item.store}
                if item.cashback_url
                    a(href=item.cashback_url, target="_blank") Visit Offer

    #cashbackFormModal.modal.fade(tabindex="-1" aria-labelledby="cashbackFormModal" aria-hidden="true")     
        .modal-dialog
            .modal-content
                .modal-header
                    h1.modal-title.fs-5#cashbackFormTitle Add a cashback offer
                    button.btn-close(type="button" data-bs-dismiss="modal" aria-label="Close")
                .modal-body.bg-secondary-subtle
                    form(action="/cashback" method="POST" id="cashback-form")
                        .mb-3 
                            label.form-label(for="product-name") Product name 
                            input.form-control(type="text" id="product-name" name="product_name" placeholder="Kinder Pengui") 
                        .mb-3 
                            label.form-label(for="cashback-url") Cashback URL 
                            input.form-control(type="text" id="cashback-url" name="cashback_url")
                        .mb-3 
                            label.form-label(for="photo-url") Product photo URL 
                            input.form-control(type="text" id="photo-url" name="photo_url")
                        .row.mb-3 
                            .col
                                label.form-label(for="start-date") Start date 
                                input.form-control(type="date" id="start-date" placeholder="01.10.2025" name="start_date")
                            .col
                                label.form-label(for="end-date") End date
                                input.form-control(type="date" id="end-date" placeholder="20.10.2025" name="end_date")
                        .row.mb-3 
                            .col
                                label.form-label(for="price") Price
                                input.form-control(type="text" id="price" placeholder="4.50" name="price")
                            .col
                                label.form-label(for="cashback-amount") Cashback
                                input.form-control(type="text" id="cashback-amount" placeholder="4.50" name="cashback_amount")
                        .mb-3 
                            label.form-label(for="store") Where to buy
                            input.form-control(type="text" id="store" placeholder="Kaufland, REWE" name="store")
                        .mb-3 
                            label.form-label(for="conditions") Conditions 
                            input.form-control(type="text" id="conditions" placeholder="Mit Aktionssticker, EAN 12345678" name="conditions")
                        .mb-3 
                            label.form-label(for="status") Status  
                            select.custom-select.custom-select-sm.m-2(name="status")
                                option Available 
                                option Uploaded
                                option Confirmed
                                option Completed           
                .modal-footer
                    button.btn.btn-secondary(type="button" ) Close
                    button.btn.btn-primary(type="submit" form="cashback-form") Save cashback offer


    script. 
        setTimeout(() => {
            const msg = document.getElementById("flash-msg");
            if (msg) msg.style.display = 'none';
            
        }, 3000);

//-  https://mdbootstrap.com/docs/standard/extended/horizontal-cards/